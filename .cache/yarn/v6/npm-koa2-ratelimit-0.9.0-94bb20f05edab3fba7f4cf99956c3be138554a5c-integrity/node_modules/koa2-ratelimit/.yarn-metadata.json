{
  "manifest": {
    "name": "koa2-ratelimit",
    "author": {
      "name": "YSO CORP"
    },
    "version": "0.9.0",
    "description": "IP rate-limiting middleware for Koajs 2. Use to limit repeated requests to APIs and/or endpoints such as password reset.",
    "main": "src/index.js",
    "engines": {
      "node": ">=7.10.1"
    },
    "people": {
      "name": "YSO CORP",
      "email": "contact@ysocorp.com",
      "url": "http://ysocorp.com"
    },
    "repository": {
      "type": "git",
      "url": "https://github.com/ysocorp/koa2-ratelimit"
    },
    "dependencies": {
      "mongoose": "^5.5.13",
      "promise-redis": "0.0.5",
      "sequelize": "^5.8.7"
    },
    "devDependencies": {
      "babel-eslint": "^10.0.1",
      "eslint": "^5.16.0",
      "eslint-config-airbnb": "^17.1.0",
      "eslint-plugin-import": "^2.17.3",
      "eslint-plugin-jsx-a11y": "^6.2.1",
      "eslint-plugin-react": "^7.13.0",
      "expect": "^24.8.0",
      "mocha": "^6.1.4"
    },
    "scripts": {
      "lint": "eslint src test",
      "test": "mocha --opts mocha.opts"
    },
    "keywords": [
      "koa2-ratelimit",
      "koa2-rate-limit",
      "koa-rate-limit",
      "koa2-ratelimit",
      "koa-ratelimit",
      "koa2-brute-force",
      "koa-brute-force",
      "koa2-bruteforce",
      "koa-bruteforce",
      "koa2",
      "rate",
      "limit",
      "sequelize",
      "mongodb",
      "ratelimit",
      "ratelimit-sequelize",
      "ratelimit-mongodb",
      "rate-limit",
      "rate-limit-sequelize",
      "rate-limit-mongodb",
      "middleware",
      "ip",
      "auth",
      "authorization",
      "security",
      "brute",
      "force",
      "bruteforce",
      "bruteforce-sequelize",
      "bruteforce-mongodb",
      "brute-force",
      "brute-force-sequelize",
      "brute-force-mongodb",
      "attack"
    ],
    "_registry": "npm",
    "_loc": "/home/ubuntu/.cache/yarn/v6/npm-koa2-ratelimit-0.9.0-94bb20f05edab3fba7f4cf99956c3be138554a5c-integrity/node_modules/koa2-ratelimit/package.json",
    "readmeFilename": "README.md",
    "readme": "#  Koajs 2 Rate Limit (Bruteforce)\n\n[![Build Status](https://secure.travis-ci.org/ysocorp/koa2-ratelimit.png?branch=master \"Test\")](http://travis-ci.org/ysocorp/koa2-ratelimit)\n[![NPM version](http://badge.fury.io/js/koa2-ratelimit.png)](https://npmjs.org/package/koa2-ratelimit \"View this project on NPM\")\n\nRate-limiting middleware for Koa2 with `async` `await`. Use to limit repeated requests to APIs and/or endpoints such as password reset.\n\nNote: This module is based on [express-rate-limit](https://github.com/nfriedly/express-rate-limit) and adapted to koa2 ES6 with the `async` `await` capabilities.\n\n## Summary\n\n- [Install](#install)\n- [Usage](#usage)\n    - [Use with RedisStore](#use-with-redisStore)\n    - [Use with SequelizeStore](#use-with-sequelizestore)\n    - [Use with MongooseStore (Mongodb)](#use-with-mongoosestore)\n- [Configuration](#configuration)\n- [Time Type](#time-type)\n\n\n## Install\n\n```sh\n$ npm install --save koa2-ratelimit\n```\n\n## Usage\n\nFor an API-only server where the rate-limiter should be applied to all requests:\n\n```js\nconst RateLimit = require('koa2-ratelimit').RateLimit;\n\nconst limiter = RateLimit.middleware({\n  interval: { min: 15 }, // 15 minutes = 15*60*1000\n  max: 100, // limit each IP to 100 requests per interval\n});\n\n//  apply to all requests\napp.use(limiter);\n```\n\nCreate multiple instances to apply different rules to different routes:\n\n```js\nconst RateLimit = require('koa2-ratelimit').RateLimit;\nconst KoaRouter = require('koa-router');\nconst router = new KoaRouter();\n\nconst getUserLimiter = RateLimit.middleware({\n  interval: 15*60*1000, // 15 minutes\n  max: 100,\n  prefixKey: 'get/user/:id' // to allow the bdd to Differentiate the endpoint \n});\n// add route with getUserLimiter middleware\nrouter.get('/user/:id', getUserLimiter, (ctx) => {\n  // Do your job\n});\n\nconst createAccountLimiter = RateLimit.middleware({\n  interval: { hour: 1, min: 30 }, // 1h30 window\n  delayAfter: 1, // begin slowing down responses after the first request\n  timeWait: 3*1000, // slow down subsequent responses by 3 seconds per request\n  max: 5, // start blocking after 5 requests\n  prefixKey: 'post/user', // to allow the bdd to Differentiate the endpoint \n  message: \"Too many accounts created from this IP, please try again after an hour\"\n});\n// add route  with createAccountLimiter middleware\nrouter.post('/user', createAccountLimiter, (ctx) => {\n  // Do your job\n});\n\n// mount routes\napp.use(router.middleware())\n\n```\n\nSet default options to all your middleware:\n\n```js\nconst RateLimit = require('koa2-ratelimit').RateLimit;\n\nRateLimit.defaultOptions({\n    message: 'Get out.',\n    // ...\n});\n\nconst getUserLimiter = RateLimit.middleware({\n  max: 100,\n  // message: 'Get out.', will be added\n});\n\nconst createAccountLimiter = RateLimit.middleware({\n  max: 5, // start blocking after 5 requests\n  // message: 'Get out.', will be added\n});\n```\n\n### Use with RedisStore \n\n```js\nconst RateLimit = require('koa2-ratelimit').RateLimit;\nconst Stores = require('koa2-ratelimit').Stores;\n\nRateLimit.defaultOptions({\n    message: 'Get out.',\n    store: new Stores.Redis({\n        host: 'redis_host',\n        port: 'redis_port',\n        password: 'redis_password',\n        db: 1\n    })\n});\n\nconst getUserLimiter = RateLimit.middleware({\n    prefixKey: 'get/user/:id',\n});\nrouter.get('/user/:id', getUserLimiter, (ctx) => {});\n\nconst createAccountLimiter = RateLimit.middleware.middleware({\n    prefixKey: 'post/user',\n});\nrouter.post('/user', createAccountLimiter, (ctx) => {});\n\n// mount routes\napp.use(router.middleware())\n```\n\n### Use with SequelizeStore \n\n```js\nconst Sequelize = require('sequelize');\nconst RateLimit = require('koa2-ratelimit').RateLimit;\nconst Stores = require('koa2-ratelimit').Stores;\n\nconst sequelize = new Sequelize(/*your config to connected to bdd*/);\n\nRateLimit.defaultOptions({\n    message: 'Get out.',\n    store: new Stores.Sequelize(sequelize, {\n        tableName: 'ratelimits', // table to manage the middleware\n        tableAbuseName: 'ratelimitsabuses', // table to store the history of abuses in.\n    })\n});\n\nconst getUserLimiter = RateLimit.middleware({\n    prefixKey: 'get/user/:id',\n});\nrouter.get('/user/:id', getUserLimiter, (ctx) => {});\n\nconst createAccountLimiter = RateLimit.middleware.middleware({\n    prefixKey: 'post/user',\n});\nrouter.post('/user', createAccountLimiter, (ctx) => {});\n\n// mount routes\napp.use(router.middleware())\n```\n\n### Use with MongooseStore (Mongodb)\n\n```js\nconst mongoose = require('mongoose');\nconst RateLimit = require('koa2-ratelimit').RateLimit;\nconst Stores = require('koa2-ratelimit').Stores;\n\nawait mongoose.connect(/*your config to connected to bdd*/);\n\nRateLimit.defaultOptions({\n    message: 'Get out.',\n    store: new Stores.Mongodb(mongoose.connection, {\n        collectionName: 'ratelimits', // table to manage the middleware\n        collectionAbuseName: 'ratelimitsabuses', // table to store the history of abuses in.\n    }),\n});\n\n```\n\nA `ctx.state.rateLimit` property is added to all requests with the `limit`, `current`, and `remaining` number of requests for usage in your application code.\n\n## Configuration\n\n* **interval**: [Time Type](#time-type) - how long should records of requests be kept in memory. Defaults to `60000` (1 minute).\n* **delayAfter**: max number of connections during `interval` before starting to delay responses. Defaults to `1`. Set to `0` to disable delaying.  \n* **timeWait**: [Time Type](#time-type) - how long to delay the response, multiplied by (number of recent hits - `delayAfter`).  Defaults to `1000` (1 second). Set to `0` to disable delaying.\n* **max**: max number of connections during `interval` milliseconds before sending a `429` response code. Defaults to `5`. Set to `0` to disable.\n* **message**: Error message returned when `max` is exceeded. Defaults to `'Too many requests, please try again later.'`\n* **statusCode**: HTTP status code returned when `max` is exceeded. Defaults to `429`.\n* **headers**: Enable headers for request limit (`X-RateLimit-Limit`) and current usage (`X-RateLimit-Remaining`) on all responses and time to wait before retrying (`Retry-After`) when `max` is exceeded.\n* **skipFailedRequests**: when `true`, failed requests (response status >= 400) won't be counted. Defaults to `false`.\n* **whitelist**: Array of whitelisted IPs to not be rate limited.\n* **getUserId**: Function used to get userId (if connected) to be added as key and saved in bdd, should an abuse case surface. Defaults:\n\n    ```js\n    async function (ctx) {\n        const whereFinds = [ctx.state.user, ctx.user, ctx.state.User, \n          ctx.User, ctx.state, ctx];\n        const toFinds = ['id', 'userId', 'user_id', 'idUser', 'id_user'];\n        for (const whereFind of whereFinds) {\n          if (whereFind) {\n            for (const toFind of toFinds) {\n              if (whereFind[toFind]) {\n                  return whereFind[toFind];\n              }\n            }\n          }\n        }\n        return null;\n    },\n    ```\n    \n* **keyGenerator**: Function used to generate keys. By default userID (if connected) or the user's IP address. Defaults:\n\n    ```js\n    async function (ctx) {\n        const userId = await this.options.getUserId(ctx);\n        if (userId) {\n            return `${this.options.prefixKey}|${userId}`;\n        }\n        return `${this.options.prefixKey}|${ctx.request.ip}`;\n    }\n    ```\n\n* **skip**: Function used to skip requests. Returning true from the function will skip limiting for that request. Defaults:\n\n    ```js\n    async function (/*ctx*/) {\n        return false;\n    }\n    ```\n\n* **handler**: The function to execute once the max limit has been exceeded. It receives the request and the response objects. The \"next\" param is available if you need to pass to the next middleware. Defaults:\n\n    ```js\n    async function (ctx/*, next*/) {\n        ctx.status = this.options.statusCode;\n        ctx.body = { message: this.options.message };\n        if (this.options.headers) {\n            ctx.set('Retry-After', Math.ceil(this.options.interval / 1000));\n        }\n    }\n    ```\n\n* **onLimitReached**: Function to listen each time the limit is reached. It call the store to save abuse, You can use it to debug/log. Defaults:\n\n    ```js\n    async function (ctx) {\n        this.store.saveAbuse({\n            key: await this.options.keyGenerator(ctx),\n            ip: ctx.request.ip,\n            user_id: await this.options.getUserId(ctx),\n        });\n    }\n    ```\n\n* **weight**: Function to set the incrementation of the counter depending on the request. Defaults:\n\n    ```js\n    async function (/*ctx*/) {\n        return 1;\n    }\n    ```\n\n* **store**: The storage to use when persisting rate limit attempts. By default, the [MemoryStore](src/MemoryStore.js) is used.\n\n  Avaliable data stores are:\n   * [MemoryStore](src/MemoryStore.js): (default)Simple in-memory option. Does not share state when app has multiple processes or servers.\n   * [SequelizeStore](src/SequelizeStore.js): more suitable for large or demanding deployments.\n\nThe `delayAfter` and `timeWait` options were written for human-facing pages such as login and password reset forms.\nFor public APIs, setting these to `0` (disabled) and relying on only `interval` and `max` for rate-limiting usually makes the most sense.\n\n\n## Time Type\nTime type can be milliseconds or an object\n```js\n    Times = {\n        ms ?: number,\n        sec ?: number,\n        min ?: number,\n        hour ?: number,\n        day ?: number,\n        week ?: number,\n        month ?: number,\n        year ?: number,\n    };\n```\n\nExamples\n```js\n    RateLimit.middleware({\n        interval: { hour: 1, min: 30 }, // 1h30 window\n        timeWait: { week: 2 }, // 2 weeks window\n    });\n    RateLimit.middleware({\n        interval: { ms: 2000 }, // 2000 ms = 2 sec\n        timeWait: 2000, // 2000 ms = 2 sec\n    });\n```\n    \n\n## License\n\nMIT © [YSO Corp](http://ysocorp.com/)\n\n",
    "license": "MIT*"
  },
  "artifacts": [],
  "remote": {
    "resolved": "https://registry.yarnpkg.com/koa2-ratelimit/-/koa2-ratelimit-0.9.0.tgz#94bb20f05edab3fba7f4cf99956c3be138554a5c",
    "type": "tarball",
    "reference": "https://registry.yarnpkg.com/koa2-ratelimit/-/koa2-ratelimit-0.9.0.tgz",
    "hash": "94bb20f05edab3fba7f4cf99956c3be138554a5c",
    "integrity": "sha512-gCjHnjm5Xgc+Qzx3Xr8qb0Iatd9Xw4YC2ZemIpdbkFTpNjfJcoI1Df5lS/H0K+NeSxggxYN0K23ToPS/SPN/Gg==",
    "registry": "npm",
    "packageName": "koa2-ratelimit",
    "cacheIntegrity": "sha512-gCjHnjm5Xgc+Qzx3Xr8qb0Iatd9Xw4YC2ZemIpdbkFTpNjfJcoI1Df5lS/H0K+NeSxggxYN0K23ToPS/SPN/Gg== sha1-lLsg8F7as/un9M+ZlWw74ThVSlw="
  },
  "registry": "npm",
  "hash": "94bb20f05edab3fba7f4cf99956c3be138554a5c"
}